<HTML><HEAD><TITLE>spforth.html</TITLE>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=windows-1251'>
<STYLE type='text/css'>
.code {
margin-left: 20px;
font-family: monospace;
font-weight: bold;
color: #0000FF;
background-color: #EFEFEF;
border: dashed 1 #00FF00
}

.index {
font-family: Courier;
}

.run, .int, .comp {
font-family: monospace;
background-color: #CFCFCF;
}

.pre {
//background-color: #CFCFCF;
font-family: monospace;
font-variant: normal;
}

.word {
font-size: larger;
font-weight: bold;
}

.link {
text-decoration: none;
color: #000000;
}

.date {
font-size: smaller;
font-style: italic;
text-align: right;
}</STYLE>
</HEAD>
<BODY bgcolor='white'><pre>
<div class=date>Generated from <b>docs/help/SPForth.fhlp</b> on Sat, 29 Jul 2006 20:37:54 GMT</div>
<span class=run>( Справка по особенностям SP-FORTH от стандарта  )</span>
<span class=run>( А также русские эквиваленты стандартных слов   )</span>

<hr>
<a id='section-0'></a><span class=word><a href='#section-0' class=link></a></span>

FORTH - Язык среднего уровня и интерактивная среда разработки.
Нашел широкое применение в науке, робототехнике, управлении
оборудованием, обработке образов и искусственном интеллекте.
Позволяет создавать очень компактные и быстрые программы.

Попробуйте набрать HELP HELP
а также TOPIC и HELP TOPIC

<hr>
<a id='section-1'></a><span class=word><a href='#section-1' class=link>{{</a></span>
<span class=run>( "name" -- )</span>

Взять из входного потока и выполнить "name".
Если это VOCABULARY сделать содержащийся в нем
wordlist первым в порядке поиска.
Если это слово, возвращающее wordlist на стеке данных,
сделать данный wordlist первым в порядке поиска.

file:  compiler\spf_modules.f
forth:  спф 4.0 и выше

IMMEDIATE слово.

<hr>
<a id='section-2'></a><span class=word><a href='#section-2' class=link>}}</a></span>
<span class=run>( -- )</span>
<div class=code>: }} PREVIOUS ; IMMEDIATE
</div>
<hr>
<a id='section-3'></a><span class=word><a href='#section-3' class=link>HELP</a></span>
<span class=run>( "name" -- )</span>
Подключает файл help.fhlp, ищется и печатается справочная
документация к слову "name".
<span class=run>( -- )</span>
Общие сведения о форте.

Поиск происходит по умолчанию в файлах
docs\help\ANSFth94.fhlp
docs\help\SPForth.fhlp

Если ничего не найдено, слово преобразуется в верхний
регистр и ищется снова. Так что можно писать help help.
Но, скорость поиска при это замедляется в 2 раза! Поэтому
целесообразно писать слово так, как оно выглядит.
Синтаксис help help для ленивых людей с мощными компьютерами (it's me :)
Вы можете создавать и подключать справку к своим
собственным библиотекам.

file: lib\ext\help.f
forth: спф 4.0 и выше

<hr>
<a id='section-4'></a><span class=word><a href='#section-4' class=link>EXTRA-MEM</a></span>

<span class=run>( -- addr )</span>

VARIABLE переменная, изначально содержит 16384.
При создании хипа функцией CREATE-HEAP общий размер
хипа равен: USER-OFFS + EXTRA-MEM + 4
Возможно перед сохранением записать в EXTRA-MEM 0.
Эта переменная нужна как буфер для USER переменных, которые
возможно будут работать на этапе подключения форт текста.

file: win\spf_win_memory.f
forth: спф 4.0 и выше

<hr>
<a id='section-5'></a><span class=word><a href='#section-5' class=link>USER</a></span>
<span class=run>( "name" -- )</span>

Создает переменную аналогично VARIABLE, но эта переменная создается
динамически при запуске форт системы и инициализируется нулем.
Сделано для поддержки многопоточности ядром. У кажого потока свои
копии USER переменных.
В сп-форте для каждого потока создается
_отдельный_ хип (и именно из него выделяется блок для USER vars).
И ALLOCATE выделяет память из локального хипа потока. Соответственно
автоматически освобождается при завершении потока (если этот поток
завершается сам, а не убивается другим потоком по STOP).

file: compiler\spf_defwords.f
forth: спф 3.75 и выше

<hr>
<a id='section-6'></a><span class=word><a href='#section-6' class=link>USER-OFFS</a></span>
<span class=run>( -- addr )</span>

VARIABLE переменная, содержит текущее смещение в области данных потока, 
где создаются USER переменные.

file: win\spf_win_memory.f
forth: спф 3.75 и выше

<hr>
<a id='section-7'></a><span class=word><a href='#section-7' class=link>IF</a></span>

IF...ELSE...THEN
Условие IF...ELSE...THEN.

<span class=run>( flag --&gt; )</span>
Параметры
flag
если flag &lt;&gt; 0 , то выполнить все слова, которые нахдятся в промежетке
IF ...THEN, кроме слов в промежутке ELSE ...THEN (если слово ELSE вообще
используется в условии).

если flag = 0, то пропустить все слова в диапозоне IF...THEN и выполнить
первое слово после слова THEN, если внутри ветви находится слово ELSE
(IF...ELSE...THEN), то выполнить все слова в промежутке ELSE...THEN.
Заметки
IF...ELSE...THEN

Рассмотрим пример слова /, которое берёт со стека два числа и делит
первое на второе и выводит на экран результат деления, но если
делитель =0 (что соответственно противоречит законам математики),
то слово выводит на экран сообщение "Ошибка деления..." и выводит
на экран результат деления = 0.
<div class=code>
 : / ( x1 x2 --&gt; )
   DUP       \ дублирую делитель   ( x1 x2 x2 )
   0=        \ сравниваю его с 0   ( x1 x2 flag )
   IF        \ если делитель = 0
      2DROP  \ , то удаляю со стека 2 числа
      0      \ осталяю на вершине стека 0
      ." Ошибка деления..."   \ вывожу сообщение об ошибке
             \ пропускаю слова в промежутке ELSE ... THEN и перехожу к слову .
   ELSE      \ иначе, если делитель не равен 0
      /      \ , то выполняю деление и на стеке остаётся результат деления
   THEN
      ." результат=" .  \ вывожу сообщение "результат=" и частное от деления
 ;
</div>
Условие может содержать альтернативную ветвь ELSE, но можно пользоваться
и без неё, если нужно обработать только одно условие.


Например:

<div class=code>
 : ЖАРКО? ( t --&gt; )
 \ слово выводит предупреждение на консоль если температура t превысит 80 С.
    80 &gt;     ( flag )
    IF    \ если температура превышает 80 C
      ." ОПАСНО ! Уменьшите нагрев!"   \ вывести предупреждение на экран
    THEN
 ;
</div>
Имеется возможность помещать оператор IF...THEN (или IF ... ELSE ... THEN)
внутрь другого оператора IF...THEN. Фактически можно использовать
неограниченную вложенность условий друг в друга.

Все условия являются совокупностью вложенных IF...THEN. Они вложены друг
в друга, как матрёшки. Три слова IF соответстуют трём словам THEN.

<div class=pre>   IF----------------|
   IF---------|      |
   IF--|      |      |
      THEN   THEN   THEN
</div>
ПОМНИТЕ ! Что каждому слову IF должно соответствовать своё THEN, причём
в пределах одного и того же определения.

Например:

<div class=code>
  IF
   ...
    IF
      ...
        IF
          ...
        THEN
     THEN
  THEN
</div>
Основненое применение условий - проверка значений, которые оставляют
операции сравнения =, &lt;&gt;, &lt;, &gt;, 0= и т.д.

<hr>
<a id='section-8'></a><span class=word><a href='#section-8' class=link>+LOOP</a></span>
<a id='section-9'></a><span class=word><a href='#section-9' class=link>?DO</a></span>
<a id='section-10'></a><span class=word><a href='#section-10' class=link>DO</a></span>
<a id='section-11'></a><span class=word><a href='#section-11' class=link>LOOP</a></span>
<a id='section-12'></a><span class=word><a href='#section-12' class=link>(+LOOP)</a></span>
<a id='section-13'></a><span class=word><a href='#section-13' class=link>(?DO)</a></span>
<a id='section-14'></a><span class=word><a href='#section-14' class=link>(DO)</a></span>
<a id='section-15'></a><span class=word><a href='#section-15' class=link>(LOOP)</a></span>
<a id='section-16'></a><span class=word><a href='#section-16' class=link>UNLOOP</a></span>

Цикл со счетчиком вида
<div class=code>
 ВерхняяГраница НачальноеЗначение DO ... LOOP
</div>реализуется с помощью кода вида
<div class=pre> (DO) [ссылка_на_Адрес2]  ....  (LOOP)
     ^                                ^
     |                                |
     Адрес1                           Адрес2
</div>
использует стек возвратов для хранения вспомогательной информации.

На стеке возвратов (специфично для спф систем) -
<div class=pre>   Адрес1
   ВерхняяГраница+0x80000000
   НачальноеЗначение-(ВерхняяГраница+0x80000000)
   (--вершина стека--)
</div>
<hr>
<a id='section-17'></a><span class=word><a href='#section-17' class=link>,"</a></span>
<tt>unstandard ," "запятая-кавычка" Compat</tt>

<span class=run>( "ccc&lt;"&gt;" -- )</span>

Выбрать из входного потока строку, ограниченную кавычкой, и уложить ее в шитый
код в формате строки со счетчиком. Выравнять указатель словаря на границу
токена функции (требования те же, что и для ячейки).

<hr>
<a id='section-18'></a><span class=word><a href='#section-18' class=link>OK</a></span>
Печатает "подсказку": текст "ok" и верхние элементы стека. Вызывается
интерпретатором при интерпретации текста с консоли.

Векторное слово, по умолчанию вызывается OK1.

<hr>
<a id='section-19'></a><span class=word><a href='#section-19' class=link>?BRANCH</a></span>
<tt>unstandard ?BRANCH "вопрос-бранч" Compat</tt>

<span class=run>( true -- ) ( I: ip[codeAddr] -- ip+ )</span>
<span class=run>( false -- ) ( I: ip[codeAddr] -- codeAddr )</span>

Код: ?BRANCH [ссылкаНаКод]

Если на стеке ненулевое значение, ссылка, находящаеся за словом ?BRANCH,
пропускается. Если на стеке нулевое значение, выполняется переход.
Используется для реализации операторов IF и WHILE

<hr>
<a id='section-20'></a><span class=word><a href='#section-20' class=link>SEE</a></span>
<span class=run>( "name" -- )</span>

Вывести машинный код слова name

file: lib\ext\disasm.f
forth: spf3.16 и выше

<hr>
<a id='section-21'></a><span class=word><a href='#section-21' class=link>MODULE:</a></span>
<span class=run>( "name" -- )</span>

start a forth module
Если такой модуль уже существует, продолжить компиляцию в него.
Если нет, создать. Установить первый wordlist поиска wordlist
модуля. А также установить CURRENT.
В настоящее время частным случаем модуля является VOCABULARY.

<b> See also: </b><i>EXPORT ;MODULE DEFINITIONS</i>

file: compiler\spf_modules.f
forth: спф 4.0 и выше

<hr>
<a id='section-22'></a><span class=word><a href='#section-22' class=link>EXPORT</a></span>
<span class=run>( wid -- wid )</span>

Начать компиляцию во внешний словарь по отношению
к данному модулю. Обязательно использовать только в пределах
модуля.

file: compiler\spf_modules.f
forth: спф 4.0 и выше

<b> See also: </b><i>MODULE: ;MODULE</i>

<hr>
<a id='section-23'></a><span class=word><a href='#section-23' class=link>;MODULE</a></span>
<span class=run>( wid -- )</span>
Закончить определение модуля, снять верхний wordlist поиска,
установить CURRENT в wid (это CURRENT перед компиляцией модуля)


<hr>
<a id='section-24'></a><span class=word><a href='#section-24' class=link>MODULE:</a></span>
<a id='section-25'></a><span class=word><a href='#section-25' class=link>EXPORT</a></span>
<a id='section-26'></a><span class=word><a href='#section-26' class=link>;MODULE</a></span>
пример использования:
<div class=code>
 MODULE: xxx
...
;MODULE
</div>
======= или
<div class=code>
MODULE: xxx
...
EXPORT
...  \ Эти слова будут компилироваться во внешний по
     \ отношению к данному модулю
;MODULE
</div>
====== или
<div class=code>
VOCABULARY xxx \ так можно, потому что VOCABULARY это частный (!)
               \ случай модуля

: test xxx PROCESS-IN-XXX ;

MODULE: xxx \ здесь в уже созданный ххх будет компилить...
...
;MODULE
</div>
====== или
<div class=code>
MODULE: xxx
...
EXPORT
...
DEFINITIONS
...
EXPORT
...
DEFINITIONS
...
;MODULE
</div>
<hr>
<a id='section-27'></a><span class=word><a href='#section-27' class=link>~ruvim</a></span>
Ruvim Pinka          ruvim@forth.org.ru
<hr>
<a id='section-28'></a><span class=word><a href='#section-28' class=link>~boa</a></span>
Bordachev Andrej     glareboa@mail.ru
<hr>
<a id='section-29'></a><span class=word><a href='#section-29' class=link>~day</a></span>
Dmitry Yakimov       ftech@tula.net
<hr>
<a id='section-30'></a><span class=word><a href='#section-30' class=link>~micro</a></span>
Dmitry Zyryanov      micro@forth.org.ru
<hr>
<a id='section-31'></a><span class=word><a href='#section-31' class=link>~1001</a></span>
Konstantin Tarasov   const@penza.com.ru
<hr>
<a id='section-32'></a><span class=word><a href='#section-32' class=link>~ac</a></span>
Andrey Cherezov      andrey@cherezov.koenig.su
<hr>
<a id='section-33'></a><span class=word><a href='#section-33' class=link>~nemnick</a></span>
Nicholas Nemtsev     nn@vdk.psc.ru
<hr>
<a id='section-34'></a><span class=word><a href='#section-34' class=link>~mak</a></span>
Michael Maximov      mak@mail.rtc.neva.ru
<hr>
<a id='section-35'></a><span class=word><a href='#section-35' class=link>~yz</a></span>
Yuriy Zhilovets      yz@nightmail.ru
<hr>
<a id='section-36'></a><span class=word><a href='#section-36' class=link>~mlg</a></span>
Michael Gassanenko   mlg@forth.org
<hr>
<a id='section-37'></a><span class=word><a href='#section-37' class=link>~oleg_sh</a></span>
Oleg Shalyopa
<hr>
<a id='section-38'></a><span class=word><a href='#section-38' class=link>~trasher</a></span>
Dmitry Bobrik


<hr>
<a id='section-39'></a><span class=word><a href='#section-39' class=link>AT-THREAD-STARTING</a></span>
<a id='section-40'></a><span class=word><a href='#section-40' class=link>AT-PROCESS-STARTING</a></span>
<a id='section-41'></a><span class=word><a href='#section-41' class=link>AT-THREAD-FINISHING</a></span>
<a id='section-42'></a><span class=word><a href='#section-42' class=link>AT-PROCESS-FINISHING</a></span>

Слова, созданные по технологии Scattered Colon Definition by ~mlg
Использование:
Например - необходимо чтобы каждый раз при запуске форт системы
печаталась цифра 2:

<div class=code>..: AT-PROCESS-STARTING 2 . ;..
</div>если еще раз:
<div class=code>..: AT-PROCESS-STARTING 2 . ;..
</div>то будет печататься уже две двойки.

..: и ;.. - специальные слова форт системы.

<hr>
<a id='section-43'></a><span class=word><a href='#section-43' class=link>spf4.ini</a></span>
Файл, который подключается при запуске форт системы словом
SPF-INI. Подключается простым INCLUDE-PROBE

<hr>
<a id='section-44'></a><span class=word><a href='#section-44' class=link>STARTLOG</a></span>
Начать лог ввода/вывода. Если лог уже открыт, очистить и начать заново

Создаёт файл spf.log и записывает его хэндл в H-STDLOG.

<hr>
<a id='section-45'></a><span class=word><a href='#section-45' class=link>ENDLOG </a></span>
Закончить запись в лог-файл.

<hr>
<a id='section-46'></a><span class=word><a href='#section-46' class=link>TO-LOG</a></span>
<span class=run>( a u -- )</span>
Записать строку в лог-файл. Вызывается в дефолтных векторах для TYPE и ACCEPT

<hr>
<a id='section-47'></a><span class=word><a href='#section-47' class=link>.TO-LOG</a></span>
<span class=run>( n -- )</span>
Записать число в лог-файл.

<hr>
<a id='section-48'></a><span class=word><a href='#section-48' class=link>H-STDLOG</a></span>
Хэндл лог-файла.

<hr>
<a id='section-49'></a><span class=word><a href='#section-49' class=link>spf.log</a></span>
Лог файл форт системы. 

<b> See also: </b><i>STARTLOG ENDLOG TO-LOG H-STDLOG</i>

<hr>
<a id='section-50'></a><span class=word><a href='#section-50' class=link>\EOF</a></span>
<span class=run>( -- )</span>
Прекращает трансляцию текущего файла. Аналог
SOURCE-ID FILE-SIZE THROW SOURCE-ID REPOSITION-FILE ...
только более короткий.

file: compiler\spf_translate.f
forth: spf 4.0 и выше

<hr>
<a id='section-51'></a><span class=word><a href='#section-51' class=link>TIMER@</a></span>
<span class=run>( -- tlo thi )</span>

Возвращает значение таймера процессора (команда RTDSC)
(только для процессоров Intel Pentium совместимых).
Число тактов процессора за прошедшее время.
Возвращаемое значение зависит от частоты процессора.

file: spf_forthproc.f
forth: spf 4.0 и выше

<hr>
<a id='section-52'></a><span class=word><a href='#section-52' class=link>NOTFOUND</a></span>
<span class=run>( addr u -- i*x )</span>

Если INTERPRET не находит слово в контексте поиска, оно
ищет NOTFOUND в текущем контексте поиска и
вызывает NOTFOUND с этим словом как параметром.
Может быть определено как:

<div class=code> : NOTFOUND ?SLITERAL ;
</div>
Но также еще поддерживается синтаксис:
&lt;vocabulary&gt;::&lt;word&gt;

Слово NOTFOUND может делать с литералом что угодно (вместо SLITERAL?)
Например:
<div class=code>
  5 5 + .
  10  Ok
  : NOTFOUND ." =" TYPE ." = " ;
   Ok
  5 5
  =5= =5=  Ok
</div>
<b> See also: </b><i>::</i>

file: compiler\spf_translate.f
forth: spf 4.0 и выше

<hr>
<a id='section-53'></a><span class=word><a href='#section-53' class=link>::</a></span>

Синтаксис доступа к словам в словарях.
&lt;vocabulary&gt;::&lt;word&gt;
Или
&lt;vocabulary1&gt;::&lt;vocabulary1&gt;::&lt;vocabulary1&gt;::&lt;word&gt;

Поддерживаются как режим компиляции, так и интерпретации.
Причем все слова кроме последнего после :: исполняются (!)
вне зависимости от состояния STATE.
Перед &lt;word&gt; может быть пробел, например: &lt;vocabulary&gt;:: &lt;word&gt;
Это для ситуаций типа:

<div class=code>: DO-SMTH::  PROCESS-SMTH S" Voc1::" EVALUATE-WITH ;

DO-SMTH:: SOME-WORD
</div>
file: compiler\spf_translate.f
forth: spf 4.0 и выше

<b> See also: </b><i>EVALUATE-WITH</i>

<hr>
<a id='section-54'></a><span class=word><a href='#section-54' class=link>EVALUATE-WITH</a></span>
<span class=run>( i*x c-addr u xt -- j*x )</span>

Считая c-addr u входным потоком, вычислить её интерпретатором xt.
Например:
<div class=code>
: SVARIABLE ( addr u )
       ['] VARIABLE EVALUATE-WITH
;
</div>
<b> See also: </b><i>EVAL-WORD EVALUATE</i>

file: compiler\spf_translate.f
forth: spf 4.0 и выше

<hr>
<a id='section-55'></a><span class=word><a href='#section-55' class=link>EVAL-WORD</a></span>
<span class=run>( c-addr u -- )</span>

Интерпретировать ( транслировать) слово с именем  c-addr u

<b> See also: </b><i>EVALUATE-WITH EVALUATE</i>

file: compiler\spf_translate.f
forth: spf 4.0 и выше

<hr>
<a id='section-56'></a><span class=word><a href='#section-56' class=link>TERMINATE</a></span>
<span class=run>( -- )</span>

Уничтожить текущий поток и его хип.

file: win\spf_win_mtask.f
forth: spf 4.0 и выше

<hr>
<a id='section-57'></a><span class=word><a href='#section-57' class=link>TOPIC</a></span>
<span class=run>( -- )</span>
Отображение содержания справки
<span class=run>( "name" -- )</span>
Отображения содержимого "name" пункта содержания (это может
быть список слов на данную тему например).

<hr>
<a id='section-58'></a><span class=word><a href='#section-58' class=link>FILE-EXIST</a></span>
<span class=run>( a u -- flag )</span>

Истина если файл с указанным именем существует.

file: win\spf_win_io.f

<hr>
<a id='section-59'></a><span class=word><a href='#section-59' class=link>FIND-FULLNAME</a></span>
<span class=run>( a u -- a1 u1 )</span>

Найти файл и вернуть его полный путь. По умолчанию файл ищется в текущем каталоге,
потом в devel, потом в каталоге с исполняемым файлом spf. Если указанный файл не найден -
выбрасывается исключение. Это слово - вектор.

file:compiler\spf_win_translate.f

</pre></BODY></HTML>
