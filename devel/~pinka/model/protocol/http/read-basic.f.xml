<?xml version="1.0" encoding="ASCII"?>
<forth xmlns="http://forth.org.ru/ForthML/">

<slot> content-rest </slot>
<comment>
  content-rest should be set from the outside
</comment>

<handler event="cleanup">
  0 content-rest!
</handler>

<def name="content-per-catch" ds=" xt -- ior "><rem> xt ( a u -- ) </rem>
  <rem> reads what the rest by content-rest value </rem>
  content-rest SWAP 'read-counted-per CATCH DUP <if> NIP NIP <exit/></if> DROP
  content-rest OVER - content-rest!
  0EQ <if> 0 <exit/></if> -1002 
</def>

<def name="with-content" ds=" xt -- "><rem> xt ( a u -- ) </rem>
  <rem> reads what the rest by content-rest value </rem>
  content-rest ALLOCATED OVER >R
  <q ds=" xt a u -- "> 
    2DUP read-exact
    0 content-rest!
    ROT EXECUTE 
  </q> CATCH
  R> FREE SWAP THROW THROW
</def>

</forth>
